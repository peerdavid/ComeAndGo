image:  gitlab/dind:latest #java:8

# Will be called before each state
# before_script:

# Will be called one time (creates our image for all states)
build_image:
  script:
   # Install and config docker
   - docker info
   #- apt-get install curl -y 
   #- curl -fsSL https://get.docker.com/ | sh
   #- usermod -aG docker root
   #- service docker start
   #- docker info
   # Install SBT
   - echo "deb http://dl.bintray.com/sbt/debian /" | tee -a /etc/apt/sources.list.d/sbt.list
   - apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 642AC823
   - apt-get update -y
   - apt-get install sbt -y
   - sbt sbt-version

stages:
 # - build
  - test
  - deploy

test:
  stage: test
  script:
    - cd implementation
    - sbt clean test
  only:
    - master

deploy:
  stage: deploy
  script:
    - ls
    - cd implementation
    - sbt docker:publishLocal
    - ls
  only:
    - master

